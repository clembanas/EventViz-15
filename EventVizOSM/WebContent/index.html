<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<link rel="stylesheet"
	href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
<script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
<script src="JSON/Borders.js"></script>
<title>EventViz</title>


<style>
#container {
	height: 600px;
	width: 100%;
	position: relative;
}

#map {
	height: 100%;
	width: 100%;
	top: 0;
	left: 0;
	position: absolute;
}

#infobox {
	height: 100%;
	width: 20%;
	right: 0;
	position: absolute;
	background-color: grey;
	visibility: hidden;
}
</style>

</head>
<body>
	<div id="container">
		<div id="map"></div>
		<div id="infobox"></div>
	</div>
	<script>
		var map = L.map('map', {
			center : [ 20.0, 5.0 ],
			minZoom : 2,
			zoom : 2
		});

		var smallRedIcon = L.icon({
			iconUrl : 'Icon/RedDot.png',
			iconSize : [ 6, 6 ],
			iconAnchor : [ 3, 3 ]
		});

		var redIcon = L.icon({
			iconUrl : 'Icon/RedDot.png',
			iconSize : [ 12, 12 ],
			iconAnchor : [ 6, 6 ]
		});

		L
				.tileLayer(
						'http://{s}.mqcdn.com/tiles/1.0.0/map/{z}/{x}/{y}.png',
						{
							attribution : '&copy; <a href="http://osm.org/copyright" title="OpenStreetMap" target="_blank">OpenStreetMap</a> contributors | Tiles Courtesy of <a href="http://www.mapquest.com/" title="MapQuest" target="_blank">MapQuest</a> <img src="http://developer.mapquest.com/content/osm/mq_logo.png" width="16" height="16">',
							subdomains : [ 'otile1', 'otile2', 'otile3',
									'otile4' ]
						}).addTo(map);
		var marker = L.marker([ 51.2117132, 5.427836 ], {
			icon : redIcon
		}).on("click", zoom).addTo(map);
		var closerMarkers = [ {
			"position" : [ 51.8, -0.20 ],
			"multiple" : [ {
				"text" : "MEvent1"
			}, {
				"text" : "MEvent2"
			}, {
				"text" : "MEvent3"
			} ]
		}, {
			"position" : [ 51.0, -0.05 ],
			"text" : "Event2"
		} ];
		var GEOdata = [];
		console.log(data);

		var normalStyle = {
			color : '#0033ff',
			weight : 5,
			opacity : 0.5,
			fillOpacity : 0.2,
			fillColor : '#0033ff'
		};
		
		var highlightStyle = {
			color : '#0033ff',
			weight : 7,
			opacity : 0.8,
			fillOpacity : 0.65,
			fillColor : '#0033ff'
		};
		
		var activeStyle = {
			color : '#0033ff',
			weight : 8,
			opacity : 0.95,
			fillOpacity : 0.8,
			fillColor : '#0033ff'
		};
	
		var currentActiveCountry = null;

		for ( var i = 0; i < data.features.length; i++) {
			L.geoJson(data.features[i], {
				name : data.features[i].properties.name
			}).on("click", function(e) {
				map.fitBounds(e.target.getBounds());
				if(currentActiveCountry != null){
					console.log(currentActiveCountry);
					currentActiveCountry.layer.setStyle(normalStyle);
				}
				currentActiveCountry = e;
				e.layer.setStyle(activeStyle);
			}).on("mouseover", function(e){
				if(currentActiveCountry == null || e.layer.options.name != currentActiveCountry.layer.options.name){
					e.layer.setStyle(highlightStyle);
				}
			}).on("mouseout", function(e){
				if(currentActiveCountry == null || e.layer.options.name != currentActiveCountry.layer.options.name){	
					e.layer.setStyle(normalStyle);
				}
			}).addTo(map);
		}
		var customMarker = L.Marker.extend({
			options : {
				text : 'text'
			}
		});
		function zoom(e) {
			map.setView(new L.LatLng(51.5, -0.09), 8);
			map.removeLayer(marker);
			var currentMarkers = [];
			var infobox = document.getElementById("infobox");
			for ( var i = 0; i < closerMarkers.length; i++) {
				if (closerMarkers[i].multiple != undefined) {
					currentMarkers[currentMarkers.length] = L
							.marker(closerMarkers[i].position, {
								icon : redIcon,
								multiple : closerMarkers[i].multiple
							}).on("click", function(e) {
										//zoom closer to that point
										map.setView(e.latlng, 10);

										//remove the previous markers
										for ( var m = 0; m < currentMarkers.length; m++) {
											map.removeLayer(currentMarkers[m]);
										}

										//add center marker
										var centerMarker = L.marker(e.latlng, {
											icon : smallRedIcon
										}).addTo(map);

										//add a circle of markers around the center marker
										for ( var m = 0; m < e.target.options.multiple.length; m++) {
											var x = 0.025 * Math.cos(m/ e.target.options.multiple.length* 2* Math.PI)+ e.latlng.lat;
											var y = 0.05 * Math.sin(m/ e.target.options.multiple.length* 2* Math.PI)+ e.latlng.lng;
											L.marker([ x, y ],{
																icon : redIcon,
																text : e.target.options.multiple[m].text
															}).on("click",function(e) {
																infobox.style.visibility = "visible";
																infobox.innerHTML = "Name: "+ e.target.options.text;
															}).addTo(map);

											var linePoints = [ [ x, y ],
													e.latlng ];
											L.polyline(linePoints, {
												color : "red",
												weight : 2,
												smoothFactor : 1
											}).addTo(map);
										}
									}).addTo(map);
				} else {
					currentMarkers[currentMarkers.length] = L.marker(
							closerMarkers[i].position, {
								icon : redIcon,
								text : closerMarkers[i].text
							}).on("click", function(e) {
						infobox.style.visibility = "visible";
						infobox.innerHTML = "Name: " + e.target.options.text;
					}).addTo(map);
				}
			}
		}
	</script>
</body>
</html>